<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🌤 America Weather App</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <style>
    body {
      background: linear-gradient(135deg, #74ebd5 0%, #9face6 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      border-radius: 20px;
    }
    h1 {
      font-weight: bold;
      color: #fff;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    }
    .weather-icon {
      font-size: 50px;
    }
    .forecast-card {
      background: #ffffffcc;
      border-radius: 12px;
      padding: 15px;
      margin: 10px;
      text-align: center;
      transition: transform 0.2s ease-in-out;
    }
    .forecast-card:hover {
      transform: scale(1.05);
    }
    footer {
      margin-top: 30px;
      text-align: center;
      color: #fff;
      font-size: 14px;
    }
  </style>
</head>
<body>

<div class="container">
  <h1 class="text-center mb-5 animate__animated animate__fadeInDown">🌤 USA Weather App</h1>

  <!-- Select Timezone -->
  <div class="row mb-4 justify-content-center animate__animated animate__fadeInUp">
    <div class="col-md-6">
      <select id="zone" class="form-select shadow-lg">
        <option value="America/New_York">New York</option>
        <option value="America/Chicago">Chicago</option>
        <option value="America/Denver">Denver</option>
        <option value="America/Los_Angeles">Los Angeles</option>
        <option value="America/Phoenix">Phoenix</option>
        <option value="America/Anchorage">Anchorage</option>
        <option value="Pacific/Honolulu">Honolulu</option>
      </select>
    </div>
    <div class="col-md-2">
      <button onclick="fetchWeather()" class="btn btn-primary w-100 shadow-lg">Get Weather</button>
    </div>
  </div>

  <!-- Current Weather -->
  <div id="weatherResult" class="card shadow-lg p-4 mb-4 animate__animated animate__fadeIn" style="display: none; background: #ffffffdd;">
    <h3 id="city" class="mb-3"></h3>
    <p><b>🌍 Timezone:</b> <span id="timezone"></span></p>
    <p><b>🕒 Local Time:</b> <span id="local_time"></span></p>
    <p><b>🌡 Temperature:</b> <span id="temperature"></span> °F</p>
    <p><b>💧 Humidity:</b> <span id="humidity"></span>%</p>
    <p><b>⛅ Weather:</b> <span id="weather"></span></p>
    <p><b>💨 Wind Speed:</b> <span id="wind_speed"></span> mph</p>
  </div>

  <!-- Forecast -->
  <div id="forecastResult" class="mt-4" style="display: none;">
    <h4 class="text-white text-center mb-4 animate__animated animate__fadeInUp">📅 5-Day / 3-Hour Forecast</h4>
    <div id="forecastCards" class="row justify-content-center"></div>
  </div>

  <footer>
    🌎 Built with ❤️ using Bootstrap + Animate.css
  </footer>
</div>

<script>
async function fetchWeather() {
  const zone = document.getElementById("zone").value;
  const API_BASE = window.location.origin;  // ✅ dynamically picks correct host:port

  try {
    // --- Fetch Current Weather ---
    const resCurrent = await fetch(`${API_BASE}/api/weather?zone=${zone}`);
    const current = await resCurrent.json();

    if (current.error) {
      alert(current.error);
      return;
    }

    document.getElementById("city").innerText = "📍 City: " + current.city;
    document.getElementById("timezone").innerText = current.timezone;
    document.getElementById("local_time").innerText = current.local_time;
    document.getElementById("temperature").innerText = current.temperature;
    document.getElementById("humidity").innerText = current.humidity;
    document.getElementById("weather").innerText = current.weather;
    document.getElementById("wind_speed").innerText = current.wind_speed;
    document.getElementById("weatherResult").style.display = "block";

    // --- Fetch Forecast ---
    const resForecast = await fetch(`${API_BASE}/api/forecast?zone=${zone}`);
    const forecast = await resForecast.json();

    const forecastCards = document.getElementById("forecastCards");
    forecastCards.innerHTML = "";

    forecast.forecast.forEach(item => {
      const card = `
        <div class="col-md-2 forecast-card shadow">
          <p><b>${item.time}</b></p>
          <p>🌡 ${item.temperature}°F</p>
          <p>💧 ${item.humidity}%</p>
          <p>${item.weather}</p>
          <p>💨 ${item.wind_speed} mph</p>
        </div>
      `;
      forecastCards.innerHTML += card;
    });

    document.getElementById("forecastResult").style.display = "block";
  } catch (err) {
    console.error("Error fetching weather:", err);
    alert("Failed to fetch weather. Check server logs.");
  }
}
</script>

</body>
</html>