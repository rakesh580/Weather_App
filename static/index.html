<!DOCTYPE html>
<html>
<head>
    <title>ðŸŒ¤ India Weather App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h1 class="text-center mb-4">ðŸŒ¤ India Weather App</h1>

    <!-- Select Timezone -->
    <div class="row mb-4">
        <div class="col-md-8">
            <select id="zone" class="form-select">
                <option value="America/New_York">New York</option>
                <option value="America/Chicago">Chicago</option>
                <option value="America/Denver">Denver</option>
                <option value="America/Los_Angeles">Los Angeles</option>
                <option value="America/Phoenix">Phoenix</option>
                <option value="America/Anchorage">Anchorage</option>
                <option value="Pacific/Honolulu">Honolulu</option>
            </select>
        </div>
        <div class="col-md-4">
            <button onclick="fetchWeather()" class="btn btn-primary w-100">Get Weather</button>
        </div>
    </div>

    <!-- Current Weather -->
    <div id="weatherResult" class="card shadow p-4 mb-4" style="display: none;">
        <h3 id="city"></h3>
        <p><b>Timezone:</b> <span id="timezone"></span></p>
        <p><b>Local Time:</b> <span id="local_time"></span></p>
        <p><b>Temperature:</b> <span id="temperature"></span> Â°F</p>
        <p><b>Humidity:</b> <span id="humidity"></span>%</p>
        <p><b>Weather:</b> <span id="weather"></span></p>
        <p><b>Wind Speed:</b> <span id="wind_speed"></span> mph</p>
    </div>

    <!-- Forecast -->
    <div id="forecastResult" class="card shadow p-4" style="display: none;">
        <h4>ðŸ“… 5-Day / 3-Hour Forecast</h4>
        <table class="table table-striped mt-3">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Temp (Â°F)</th>
                    <th>Humidity (%)</th>
                    <th>Weather</th>
                    <th>Wind Speed (mph)</th>
                </tr>
            </thead>
            <tbody id="forecastTable"></tbody>
        </table>
    </div>
</div>

<script>
async function fetchWeather() {
    const zone = document.getElementById("zone").value;
    const API_BASE = window.location.origin;  // âœ… dynamically picks correct host:port

    try {
        // --- Fetch Current Weather ---
        const resCurrent = await fetch(`${API_BASE}/api/weather?zone=${zone}`);
        const current = await resCurrent.json();

        if (current.error) {
            alert(current.error);
            return;
        }

        document.getElementById("city").innerText = "City: " + current.city;
        document.getElementById("timezone").innerText = current.timezone;
        document.getElementById("local_time").innerText = current.local_time;
        document.getElementById("temperature").innerText = current.temperature;
        document.getElementById("humidity").innerText = current.humidity;
        document.getElementById("weather").innerText = current.weather;
        document.getElementById("wind_speed").innerText = current.wind_speed;
        document.getElementById("weatherResult").style.display = "block";

        // --- Fetch Forecast ---
        const resForecast = await fetch(`${API_BASE}/api/forecast?zone=${zone}`);
        const forecast = await resForecast.json();

        const tableBody = document.getElementById("forecastTable");
        tableBody.innerHTML = "";

        forecast.forecast.forEach(item => {
            const row = `<tr>
                <td>${item.time}</td>
                <td>${item.temperature}</td>
                <td>${item.humidity}</td>
                <td>${item.weather}</td>
                <td>${item.wind_speed}</td>
            </tr>`;
            tableBody.innerHTML += row;
        });

        document.getElementById("forecastResult").style.display = "block";
    } catch (err) {
        console.error("Error fetching weather:", err);
        alert("Failed to fetch weather. Check server logs.");
    }
}
</script>

</body>
</html>